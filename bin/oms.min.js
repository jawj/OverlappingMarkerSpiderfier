(function(){/*
 OverlappingMarkerSpiderfier
https://github.com/jawj/OverlappingMarkerSpiderfier
Copyright (c) 2011 - 2013 George MacKerron
Released under the MIT licence: http://opensource.org/licenses/mit-license
Note: The Google Maps API v3 must be included *before* this code
*/
(function(){var w,y={}.hasOwnProperty,z=[].slice;null!=(null!=(w=this.google)?w.maps:void 0)&&(this.OverlappingMarkerSpiderfier=function(){function t(b,d){var a,g,f,e,c=this;this.map=b;null==d&&(d={});for(a in d)y.call(d,a)&&(g=d[a],this[a]=g);this.e=new this.constructor.g(this.map);this.n();this.b={};e=["click","zoom_changed","maptypeid_changed"];g=0;for(f=e.length;g<f;g++)a=e[g],m.addListener(this.map,a,function(){return c.unspiderfy()})}var m,r,s,p,h,c,u,v;c=t.prototype;v=[t,c];p=0;for(h=v.length;p<
h;p++)s=v[p],s.VERSION="0.4";r=google.maps;m=r.event;h=r.MapTypeId;u=2*Math.PI;c.keepSpiderfied=!1;c.markersWontHide=!1;c.markersWontMove=!1;c.nearbyDistance=20;c.circleSpiralSwitchover=9;c.circleFootSeparation=23;c.circleStartAngle=u/12;c.spiralFootSeparation=26;c.spiralLengthStart=11;c.spiralLengthFactor=4;c.spiderfiedZIndex=1E3;c.usualLegZIndex=10;c.highlightedLegZIndex=20;c.legWeight=1.5;c.legColors={usual:{},highlighted:{}};p=c.legColors.usual;s=c.legColors.highlighted;p[h.HYBRID]=p[h.SATELLITE]=
"#fff";s[h.HYBRID]=s[h.SATELLITE]="#f00";p[h.TERRAIN]=p[h.ROADMAP]="#444";s[h.TERRAIN]=s[h.ROADMAP]="#f00";c.n=function(){this.a=[];this.j=[]};c.addMarker=function(b){var d,a=this;if(null!=b._oms)return this;b._oms=!0;d=[m.addListener(b,"click",function(d){return a.G(b,d)})];this.markersWontHide||d.push(m.addListener(b,"visible_changed",function(){return a.o(b,!1)}));this.markersWontMove||d.push(m.addListener(b,"position_changed",function(){return a.o(b,!0)}));this.j.push(d);this.a.push(b);return this};
c.o=function(b,d){if(null!=b._omsData&&(d||!b.getVisible())&&null==this.s&&null==this.t)return this.unspiderfy(d?b:null)};c.getMarkers=function(){return this.a.slice(0)};c.removeMarker=function(b){var d,a,g,f,e;null!=b._omsData&&this.unspiderfy();d=this.m(this.a,b);if(0>d)return this;g=this.j.splice(d,1)[0];f=0;for(e=g.length;f<e;f++)a=g[f],m.removeListener(a);delete b._oms;this.a.splice(d,1);return this};c.clearMarkers=function(){var b,d,a,g,f,e,c,l;this.unspiderfy();l=this.a;b=g=0;for(e=l.length;g<
e;b=++g){a=l[b];d=this.j[b];f=0;for(c=d.length;f<c;f++)b=d[f],m.removeListener(b);delete a._oms}this.n();return this};c.addListener=function(b,d){var a,g;(null!=(g=(a=this.b)[b])?g:a[b]=[]).push(d);return this};c.removeListener=function(b,d){var a;a=this.m(this.b[b],d);0>a||this.b[b].splice(a,1);return this};c.clearListeners=function(b){this.b[b]=[];return this};c.trigger=function(){var b,d,a,g,f,e;d=arguments[0];b=2<=arguments.length?z.call(arguments,1):[];d=null!=(a=this.b[d])?a:[];e=[];g=0;for(f=
d.length;g<f;g++)a=d[g],e.push(a.apply(null,b));return e};c.u=function(b,d){var a,g,f,e,c;f=this.circleFootSeparation*(2+b)/u;g=u/b;c=[];for(a=e=0;0<=b?e<b:e>b;a=0<=b?++e:--e)a=this.circleStartAngle+a*g,c.push(new r.Point(d.x+f*Math.cos(a),d.y+f*Math.sin(a)));return c};c.v=function(b,d){var a,g,f,e,c;f=this.spiralLengthStart;a=0;c=[];for(g=e=0;0<=b?e<b:e>b;g=0<=b?++e:--e)a+=this.spiralFootSeparation/f+5E-4*g,g=new r.Point(d.x+f*Math.cos(a),d.y+f*Math.sin(a)),f+=u*this.spiralLengthFactor/a,c.push(g);
return c};c.G=function(b,d){var a,g,f,e,c,l,k,x,n;(e=null!=b._omsData)&&this.keepSpiderfied||this.unspiderfy();if(e||this.map.getStreetView().getVisible()||"GoogleEarthAPI"===this.map.getMapTypeId())return this.trigger("click",b,d),m.trigger(b,"spider_click",d);e=[];c=[];a=this.nearbyDistance;l=a*a;f=this.c(b.position);n=this.a;k=0;for(x=n.length;k<x;k++)a=n[k],null!=a.map&&a.getVisible()&&(g=this.c(a.position),this.f(g,f)<l?e.push({B:a,p:g}):c.push(a));return 1===e.length?(this.trigger("click",b,
d),m.trigger(b,"spider_click",d)):this.H(e,c)};c.markersNearMarker=function(b,d){var a,g,f,e,c,l,k,m,n,h;null==d&&(d=!1);if(null==this.e.getProjection())throw"Must wait for 'idle' event on map before calling markersNearMarker";a=this.nearbyDistance;c=a*a;f=this.c(b.position);e=[];m=this.a;l=0;for(k=m.length;l<k&&!(a=m[l],a!==b&&null!=a.map&&a.getVisible()&&(g=this.c(null!=(n=null!=(h=a._omsData)?h.l:void 0)?n:a.position),this.f(g,f)<c&&(e.push(a),d)));l++);return e};c.markersNearAnyOtherMarker=function(){var b,
d,a,g,c,e,q,l,k,m,n,h;if(null==this.e.getProjection())throw"Must wait for 'idle' event on map before calling markersNearAnyOtherMarker";e=this.nearbyDistance;b=e*e;g=this.a;e=[];n=0;for(a=g.length;n<a;n++)d=g[n],e.push({q:this.c(null!=(q=null!=(k=d._omsData)?k.l:void 0)?q:d.position),d:!1});n=this.a;d=q=0;for(k=n.length;q<k;d=++q)if(a=n[d],null!=a.map&&a.getVisible()&&(g=e[d],!g.d))for(h=this.a,a=l=0,m=h.length;l<m;a=++l)if(c=h[a],a!==d&&null!=c.map&&c.getVisible()&&(c=e[a],(!(a<d)||c.d)&&this.f(g.q,
c.q)<b)){g.d=c.d=!0;break}n=this.a;a=[];b=q=0;for(k=n.length;q<k;b=++q)d=n[b],e[b].d&&a.push(d);return a};c.A=function(b){var d=this;return{h:function(){return b._omsData.i.setOptions({strokeColor:d.legColors.highlighted[d.map.mapTypeId],zIndex:d.highlightedLegZIndex})},k:function(){return b._omsData.i.setOptions({strokeColor:d.legColors.usual[d.map.mapTypeId],zIndex:d.usualLegZIndex})}}};c.H=function(b,d){var a,c,f,e,q,l,k,h,n,p;this.s=!0;p=b.length;a=this.D(function(){var a,d,c;c=[];a=0;for(d=b.length;a<
d;a++)h=b[a],c.push(h.p);return c}());e=p>=this.circleSpiralSwitchover?this.v(p,a).reverse():this.u(p,a);a=function(){var a,d,h,p=this;h=[];a=0;for(d=e.length;a<d;a++)f=e[a],c=this.F(f),n=this.C(b,function(a){return p.f(a.p,f)}),k=n.B,l=new r.Polyline({map:this.map,path:[k.position,c],strokeColor:this.legColors.usual[this.map.mapTypeId],strokeWeight:this.legWeight,zIndex:this.usualLegZIndex}),k._omsData={l:k.position,i:l},this.legColors.highlighted[this.map.mapTypeId]!==this.legColors.usual[this.map.mapTypeId]&&
(q=this.A(k),k._omsData.w={h:m.addListener(k,"mouseover",q.h),k:m.addListener(k,"mouseout",q.k)}),k.setPosition(c),k.setZIndex(Math.round(this.spiderfiedZIndex+f.y)),h.push(k);return h}.call(this);delete this.s;this.r=!0;return this.trigger("spiderfy",a,d)};c.unspiderfy=function(b){var d,a,c,f,e,h,l;null==b&&(b=null);if(null==this.r)return this;this.t=!0;f=[];c=[];l=this.a;e=0;for(h=l.length;e<h;e++)a=l[e],null!=a._omsData?(a._omsData.i.setMap(null),a!==b&&a.setPosition(a._omsData.l),a.setZIndex(null),
d=a._omsData.w,null!=d&&(m.removeListener(d.h),m.removeListener(d.k)),delete a._omsData,f.push(a)):c.push(a);delete this.t;delete this.r;this.trigger("unspiderfy",f,c);return this};c.f=function(b,d){var a,c;a=b.x-d.x;c=b.y-d.y;return a*a+c*c};c.D=function(b){var d,a,c,f,e;f=a=c=0;for(e=b.length;f<e;f++)d=b[f],a+=d.x,c+=d.y;b=b.length;return new r.Point(a/b,c/b)};c.c=function(b){return this.e.getProjection().fromLatLngToDivPixel(b)};c.F=function(b){return this.e.getProjection().fromDivPixelToLatLng(b)};
c.C=function(b,d){var a,c,f,e,h,l;f=h=0;for(l=b.length;h<l;f=++h)if(e=b[f],e=d(e),"undefined"===typeof a||null===a||e<c)c=e,a=f;return b.splice(a,1)[0]};c.m=function(b,c){var a,g,f,e;if(null!=b.indexOf)return b.indexOf(c);a=f=0;for(e=b.length;f<e;a=++f)if(g=b[a],g===c)return a;return-1};t.g=function(b){return this.setMap(b)};t.g.prototype=new r.OverlayView;t.g.prototype.draw=function(){};return t}())}).call(this);}).call(this);
/* Wed 4 Sep 2013 11:08:39 BST */
