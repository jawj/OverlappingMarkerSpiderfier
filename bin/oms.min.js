(function(){/*
 OverlappingMarkerSpiderfier
https://github.com/jawj/OverlappingMarkerSpiderfier
Copyright (c) 2011 - 2012 George MacKerron
Released under the MIT licence: http://opensource.org/licenses/mit-license
Note: The Google Maps API v3 must be included *before* this code
*/
var h=!0,q=null,r=!1;
(function(){var v,w={}.hasOwnProperty,x=[].slice;if(((v=this.google)!=q?v.maps:void 0)!=q)this.OverlappingMarkerSpiderfier=function(){function o(b,c){var a,g,e,f,d=this;this.map=b;c==q&&(c={});for(a in c)w.call(c,a)&&(g=c[a],this[a]=g);this.p=new this.constructor.f(this.map);this.m();this.b={};f=["click","zoom_changed","maptypeid_changed"];g=0;for(e=f.length;g<e;g++)a=f[g],n.addListener(this.map,a,function(){return d.unspiderfy()})}var n,p,s,t,m,d,u;d=o.prototype;d.VERSION="0.2.8";p=google.maps;n=
p.event;m=p.MapTypeId;u=2*Math.PI;d.keepSpiderfied=r;d.markersWontHide=r;d.markersWontMove=r;d.nearbyDistance=20;d.circleSpiralSwitchover=9;d.circleFootSeparation=23;d.circleStartAngle=u/12;d.spiralFootSeparation=26;d.spiralLengthStart=11;d.spiralLengthFactor=4;d.spiderfiedZIndex=1E3;d.usualLegZIndex=10;d.highlightedLegZIndex=20;d.legWeight=1.5;d.legColors={usual:{},highlighted:{}};t=d.legColors.usual;s=d.legColors.highlighted;t[m.HYBRID]=t[m.SATELLITE]="#fff";s[m.HYBRID]=s[m.SATELLITE]="#f00";t[m.TERRAIN]=
t[m.ROADMAP]="#444";s[m.TERRAIN]=s[m.ROADMAP]="#f00";d.m=function(){this.a=[];this.i=[]};d.addMarker=function(b){var c,a=this;if(b._oms!=q)return this;b._oms=h;c=[n.addListener(b,"click",function(){return a.F(b)})];this.markersWontHide||c.push(n.addListener(b,"visible_changed",function(){return a.n(b,r)}));this.markersWontMove||c.push(n.addListener(b,"position_changed",function(){return a.n(b,h)}));this.i.push(c);this.a.push(b);return this};d.n=function(b,c){if(b._omsData!=q&&(c||!b.getVisible())&&
!(this.s!=q||this.t!=q))return this.H(c?b:q)};d.getMarkers=function(){return this.a.slice(0)};d.removeMarker=function(b){var c,a,g,e,f;b._omsData!=q&&this.unspiderfy();c=this.l(this.a,b);if(0>c)return this;g=this.i.splice(c,1)[0];e=0;for(f=g.length;e<f;e++)a=g[e],n.removeListener(a);delete b._oms;this.a.splice(c,1);return this};d.clearMarkers=function(){var b,c,a,g,e,f,d,i;this.unspiderfy();i=this.a;b=g=0;for(f=i.length;g<f;b=++g){a=i[b];c=this.i[b];e=0;for(d=c.length;e<d;e++)b=c[e],n.removeListener(b);
delete a._oms}this.m();return this};d.addListener=function(b,c){var a,g;((g=(a=this.b)[b])!=q?g:a[b]=[]).push(c);return this};d.removeListener=function(b,c){var a;a=this.l(this.b[b],c);0>a||this.b[b].splice(a,1);return this};d.clearListeners=function(b){this.b[b]=[];return this};d.trigger=function(){var b,c,a,g,e,f;c=arguments[0];b=2<=arguments.length?x.call(arguments,1):[];c=(a=this.b[c])!=q?a:[];f=[];g=0;for(e=c.length;g<e;g++)a=c[g],f.push(a.apply(q,b));return f};d.u=function(b,c){var a,g,e,f,
d;e=this.circleFootSeparation*(2+b)/u;g=u/b;d=[];for(a=f=0;0<=b?f<b:f>b;a=0<=b?++f:--f)a=this.circleStartAngle+a*g,d.push(new p.Point(c.x+e*Math.cos(a),c.y+e*Math.sin(a)));return d};d.v=function(b,c){var a,g,e,f,d;e=this.spiralLengthStart;a=0;d=[];for(g=f=0;0<=b?f<b:f>b;g=0<=b?++f:--f)a+=this.spiralFootSeparation/e+5.0E-4*g,g=new p.Point(c.x+e*Math.cos(a),c.y+e*Math.sin(a)),e+=u*this.spiralLengthFactor/a,d.push(g);return d};d.F=function(b){var c,a,g,e,f,d,i,j,k;e=b._omsData!=q;(!e||!this.keepSpiderfied)&&
this.unspiderfy();if(e||this.map.getStreetView().getVisible())return this.trigger("click",b);e=[];f=[];c=this.nearbyDistance;d=c*c;g=this.c(b.position);k=this.a;i=0;for(j=k.length;i<j;i++)c=k[i],c.map!=q&&c.getVisible()&&(a=this.c(c.position),this.e(a,g)<d?e.push({A:c,o:a}):f.push(c));return 1===e.length?this.trigger("click",b):this.G(e,f)};d.willSpiderfy=function(b){var c,a,g,e,f,d,i,j;a=this.nearbyDistance;g=a*a;a=this.c(b.position);d=this.a;e=0;for(f=d.length;e<f;e++)if(c=d[e],!(c===b||c.map==
q||!c.getVisible()))if(c=this.c((i=(j=c._omsData)!=q?j.k:void 0)!=q?i:c.position),this.e(c,a)<g)return h;return r};d.markersThatWillAndWontSpiderfy=function(){var b,c,a,g,e,d,l,i,j,k,n,m;d=this.nearbyDistance;b=d*d;g=this.a;d=[];k=0;for(a=g.length;k<a;k++)c=g[k],d.push({q:this.c((l=(i=c._omsData)!=q?i.k:void 0)!=q?l:c.position),d:r});k=this.a;c=l=0;for(i=k.length;l<i;c=++l)if(a=k[c],a.map!=q&&a.getVisible()&&(g=d[c],!g.d)){m=this.a;a=j=0;for(n=m.length;j<n;a=++j)if(e=m[a],a!==c&&(e.map!=q&&e.getVisible())&&
(e=d[a],(!(a<c)||e.d)&&this.e(g.q,e.q)<b)){g.d=e.d=h;break}}l=[];i=[];g=this.a;b=k=0;for(a=g.length;k<a;b=++k)c=g[b],(d[b].d?l:i).push(c);return[l,i]};d.z=function(b){var c=this;return{g:function(){return b._omsData.h.setOptions({strokeColor:c.legColors.highlighted[c.map.mapTypeId],zIndex:c.highlightedLegZIndex})},j:function(){return b._omsData.h.setOptions({strokeColor:c.legColors.usual[c.map.mapTypeId],zIndex:c.usualLegZIndex})}}};d.G=function(b,c){var a,d,e,f,l,i,j,k,m,o;this.s=h;o=b.length;a=
this.C(function(){var a,c,d;d=[];a=0;for(c=b.length;a<c;a++)k=b[a],d.push(k.o);return d}());f=o>=this.circleSpiralSwitchover?this.v(o,a).reverse():this.u(o,a);a=function(){var a,c,k,o=this;k=[];a=0;for(c=f.length;a<c;a++)e=f[a],d=this.D(e),m=this.B(b,function(a){return o.e(a.o,e)}),j=m.A,i=new p.Polyline({map:this.map,path:[j.position,d],strokeColor:this.legColors.usual[this.map.mapTypeId],strokeWeight:this.legWeight,zIndex:this.usualLegZIndex}),j._omsData={k:j.position,h:i},this.legColors.highlighted[this.map.mapTypeId]!==
this.legColors.usual[this.map.mapTypeId]&&(l=this.z(j),j._omsData.w={g:n.addListener(j,"mouseover",l.g),j:n.addListener(j,"mouseout",l.j)}),j.setPosition(d),j.setZIndex(Math.round(this.spiderfiedZIndex+e.y)),k.push(j);return k}.call(this);delete this.s;this.r=h;return this.trigger("spiderfy",a,c)};d.unspiderfy=function(b){var c,a,d,e,f,l,i;b==q&&(b=q);if(this.r==q)return this;this.t=h;e=[];d=[];i=this.a;f=0;for(l=i.length;f<l;f++)a=i[f],a._omsData!=q?(a._omsData.h.setMap(q),a!==b&&a.setPosition(a._omsData.k),
a.setZIndex(q),c=a._omsData.w,c!=q&&(n.removeListener(c.g),n.removeListener(c.j)),delete a._omsData,e.push(a)):d.push(a);delete this.t;delete this.r;this.trigger("unspiderfy",e,d);return this};d.e=function(b,c){var a,d;a=b.x-c.x;d=b.y-c.y;return a*a+d*d};d.C=function(b){var c,a,d,e,f;e=a=d=0;for(f=b.length;e<f;e++)c=b[e],a+=c.x,d+=c.y;b=b.length;return new p.Point(a/b,d/b)};d.c=function(b){return this.p.getProjection().fromLatLngToDivPixel(b)};d.D=function(b){return this.p.getProjection().fromDivPixelToLatLng(b)};
d.B=function(b,c){var a,d,e,f,l,i;e=l=0;for(i=b.length;l<i;e=++l)if(f=b[e],f=c(f),!("undefined"!==typeof a&&a!==q)||f<d)d=f,a=e;return b.splice(a,1)[0]};d.l=function(b,c){var a,d,e,f;if(b.indexOf!=q)return b.indexOf(c);a=e=0;for(f=b.length;e<f;a=++e)if(d=b[a],d===c)return a;return-1};o.f=function(b){return this.setMap(b)};o.f.prototype=new p.OverlayView;o.f.prototype.draw=function(){};return o}()}).call(this);}).call(this);
/* Wed 5 Sep 2012 14:43:01 BST */
